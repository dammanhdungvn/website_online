-- Xóa database nếu đã tồn tại và tạo lại
DROP DATABASE IF EXISTS BTL_WEB_HUMG;
CREATE DATABASE IF NOT EXISTS BTL_WEB_HUMG;
USE BTL_WEB_HUMG;

-- Bảng USERS
CREATE TABLE IF NOT EXISTS USERS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    FIRSTNAME VARCHAR(50) NOT NULL,
    LASTNAME VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    PHONE VARCHAR(20) DEFAULT NULL,
    PASSWORD VARCHAR(100) NOT NULL,
    FORGOT_TOKEN VARCHAR(255) DEFAULT NULL,
    ACTIVE_TOKEN VARCHAR(255) DEFAULT NULL,
    STATUS INT NOT NULL DEFAULT 0,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Bảng LOGIN_TOKEN
CREATE TABLE IF NOT EXISTS LOGIN_TOKEN (
    TOKEN_ID INT AUTO_INCREMENT PRIMARY KEY,
    USER_ID INT NOT NULL,
    TOKEN VARCHAR(255) NOT NULL UNIQUE,
    EXPIRES_AT DATETIME NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_USER_TOKEN FOREIGN KEY (USER_ID) REFERENCES USERS(ID) ON DELETE CASCADE
);

-- Bảng SUBJECTS
CREATE TABLE IF NOT EXISTS SUBJECTS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NAME_SUBJECT VARCHAR(255) NOT NULL
);

-- Bảng QUESTIONS
CREATE TABLE IF NOT EXISTS QUESTIONS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    QUESTION TEXT NOT NULL,
    SUBJECT_ID INT,
    CONSTRAINT FK_QUESTION_SUBJECT FOREIGN KEY (SUBJECT_ID) REFERENCES SUBJECTS(ID) ON DELETE CASCADE
);

-- Bảng ANSWERS
CREATE TABLE IF NOT EXISTS ANSWERS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    QUESTION_ID INT NOT NULL,
    ANSWER TEXT NOT NULL,
    IS_CORRECT BOOLEAN DEFAULT FALSE,
    CONSTRAINT FK_ANSWER_QUESTION FOREIGN KEY (QUESTION_ID) REFERENCES QUESTIONS(ID) ON DELETE CASCADE
);

-- Bảng SCORE
CREATE TABLE IF NOT EXISTS SCORE (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    POINT INT NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
